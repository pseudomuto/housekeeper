description: "Creating and managing views and materialized views"
current_sql: ""
target_sql: |
  CREATE VIEW analytics.daily_summary AS SELECT date, count(*) AS total FROM events GROUP BY date;
  CREATE MATERIALIZED VIEW analytics.mv_daily_stats ENGINE = MergeTree() ORDER BY date AS SELECT toDate(timestamp) AS date, count() AS cnt FROM events GROUP BY date;
expected_migration:
  up_contains:
    - "CREATE VIEW analytics.daily_summary AS SELECTdate,count(*)astotalFROMeventsGROUPBYdate;"
    - "CREATE MATERIALIZED VIEW analytics.mv_daily_stats ENGINE = MergeTree() ORDER BY date AS SELECTtoDate(timestamp)asdate,count()ascntFROMeventsGROUPBYdate;"
  down_contains:
    - "DROP VIEW IF EXISTS analytics.daily_summary;"
    - "DROP TABLE IF EXISTS analytics.mv_daily_stats;"
  diff_count: 2
  diff_types:
    - "CREATE"
    - "CREATE"

